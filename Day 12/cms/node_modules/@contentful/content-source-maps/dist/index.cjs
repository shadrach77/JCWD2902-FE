"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var k={0:8203,1:8204,2:8205,3:8290,4:8291,5:8288,6:65279,7:8289,8:119155,9:119156,a:119157,b:119158,c:119159,d:119160,e:119161,f:119162},C={0:8203,1:8204,2:8205,3:65279},F=new Array(4).fill(String.fromCodePoint(C[0])).join(""),W="\0";function V(e){let t=JSON.stringify(e);return`${F}${Array.from(t).map(r=>{let o=r.charCodeAt(0);if(o>255)throw new Error(`Only ASCII edit info can be encoded. Error attempting to encode ${t} on character ${r} (${o})`);return Array.from(o.toString(4).padStart(4,"0")).map(n=>String.fromCodePoint(C[n])).join("")}).join("")}`}function Q(e){return!Number.isNaN(Number(e))||/[a-z]/i.test(e)&&!/\d+(?:[-:\/]\d+){2}(?:T\d+(?:[-:\/]\d+){1,2}(\.\d+)?Z?)?/.test(e)?!1:!!Date.parse(e)}function G(e){try{new URL(e,e.startsWith("/")?"https://acme.com":void 0)}catch(t){return!1}return!0}function z(e,t,r="auto"){return r===!0||r==="auto"&&(Q(e)||G(e))?e:`${e}${V(t)}`}var Z=Object.fromEntries(Object.entries(C).map(e=>e.reverse())),_=Object.fromEntries(Object.entries(k).map(e=>e.reverse())),H=`${Object.values(k).map(e=>`\\u{${e.toString(16)}}`).join("")}`,b=new RegExp(`[${H}]{4,}`,"gu");function K(e){let t=e.match(b);if(t)return X(t[0],!0)[0]}function X(e,t=!1){let r=Array.from(e);if(r.length%2===0){if(r.length%4||!e.startsWith(F))return Y(r,t)}else throw new Error("Encoded data has invalid length");let o=[];for(let n=r.length*.25;n--;){let s=r.slice(n*4,n*4+4).map(i=>Z[i.codePointAt(0)]).join("");o.unshift(String.fromCharCode(parseInt(s,4)))}if(t){o.shift();let n=o.indexOf(W);return n===-1&&(n=o.length),[JSON.parse(o.slice(0,n).join(""))]}return o.join("").split(W).filter(Boolean).map(n=>JSON.parse(n))}function Y(e,t){var r;let o=[];for(let c=e.length*.5;c--;){let a=`${_[e[c*2].codePointAt(0)]}${_[e[c*2+1].codePointAt(0)]}`;o.unshift(String.fromCharCode(parseInt(a,16)))}let n=[],s=[o.join("")],i=10;for(;s.length;){let c=s.shift();try{if(n.push(JSON.parse(c)),t)return n}catch(a){if(!i--)throw a;let f=+((r=a.message.match(/\sposition\s(\d+)$/))==null?void 0:r[1]);if(!f)throw a;s.unshift(c.substring(0,f),c.substring(f))}}return n}function q(e){var t;return{cleaned:e.replace(b,""),encoded:((t=e.match(b))==null?void 0:t[0])||""}}function $(e,t){return z(e,t)}function ee(e){return V(e)}function te(e){return K(e)}function ne(e){return q(e)}var re=Object.prototype.hasOwnProperty,oe=Object.prototype.toString,se=function(t,r,o){if(oe.call(r)!=="[object Function]")throw new TypeError("iterator must be a function");var n=t.length;if(n===+n)for(var s=0;s<n;s++)r.call(o,t[s],s,t);else for(var i in t)re.call(t,i)&&r.call(o,t[i],i,t)},ce=se,y=u;function u(e,t,r){if(arguments.length===3)return u.set(e,t,r);if(arguments.length===2)return u.get(e,t);var o=u.bind(u,e);for(var n in u)u.hasOwnProperty(n)&&(o[n]=u[n].bind(o,e));return o}u.get=function(t,r){for(var o=Array.isArray(r)?r:u.parse(r),n=0;n<o.length;++n){var s=o[n];if(!(typeof t=="object"&&s in t))throw new Error("Invalid reference token: "+s);t=t[s]}return t};u.set=function(t,r,o){var n=Array.isArray(r)?r:u.parse(r),s=n[0];if(n.length===0)throw Error("Can not set the root object");for(var i=0;i<n.length-1;++i){var c=n[i];typeof c!="string"&&typeof c!="number"&&(c=String(c)),!(c==="__proto__"||c==="constructor"||c==="prototype")&&(c==="-"&&Array.isArray(t)&&(c=t.length),s=n[i+1],c in t||(s.match(/^(\d+|-)$/)?t[c]=[]:t[c]={}),t=t[c])}return s==="-"&&Array.isArray(t)&&(s=t.length),t[s]=o,this};u.remove=function(e,t){var r=Array.isArray(t)?t:u.parse(t),o=r[r.length-1];if(o===void 0)throw new Error('Invalid JSON pointer for remove: "'+t+'"');var n=u.get(e,r.slice(0,-1));if(Array.isArray(n)){var s=+o;if(o===""&&isNaN(s))throw new Error('Invalid array index: "'+o+'"');Array.prototype.splice.call(n,s,1)}else delete n[o]};u.dict=function(t,r){var o={};return u.walk(t,function(n,s){o[s]=n},r),o};u.walk=function(t,r,o){var n=[];o=o||function(s){var i=Object.prototype.toString.call(s);return i==="[object Object]"||i==="[object Array]"},function s(i){ce(i,function(c,a){n.push(String(a)),o(c)?s(c):r(c,u.compile(n)),n.pop()})}(t)};u.has=function(t,r){try{u.get(t,r)}catch(o){return!1}return!0};u.escape=function(t){return t.toString().replace(/~/g,"~0").replace(/\//g,"~1")};u.unescape=function(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")};u.parse=function(t){if(t==="")return[];if(t.charAt(0)!=="/")throw new Error("Invalid JSON pointer: "+t);return t.substring(1).split(/\//).map(u.unescape)};u.compile=function(t){return t.length===0?"":"/"+t.map(u.escape).join("/")};const D=({pointer:e,mappings:t,data:r,hiddenStrings:o})=>{const n=t[e];delete t[e];const s=U(r,e);for(const i of s){t[i]=n;const c=y.get(r,i),a=$(c,o);y.set(r,i,a)}},U=(e,t="")=>{const r=[],o=y.get(e,t);if(o.content)for(let n=0;n<o.content.length;n++)o.content[n].nodeType==="text"?r.push(`${t}/content/${n}/value`):r.push(...U(e,`${t}/content/${n}`));return r},T=({entityId:e,entityType:t,space:r,environment:o,field:n,locale:s,editorInterface:i,fieldType:c,targetOrigin:a})=>({origin:"contentful.com",href:`${`${a||"https://app.contentful.com"}/spaces/${r}/environments/${o}`}/${t==="Entry"?"entries":"assets"}/${e}/?focusedField=${n}&focusedLocale=${s}`,contentful:{space:r,environment:o,field:n,locale:s,entity:e,entityType:t,editorInterface:i,fieldType:c}}),P=e=>["builtin","sidebar-builtin","editor-builtin"].includes(e),x=e=>j.includes(e);function M(e){if(typeof structuredClone=="function")return structuredClone(e);try{return JSON.parse(JSON.stringify(e))}catch(t){return console.warn("Failed to clone data:",e,t),e}}const j=["singleLine","tagEditor","listInput","checkbox","richTextEditor","multipleLine","markdown"];function O(e,t,r,o,n,s,i){const c=i?t[i]:t;switch(e){case"Symbol":{const a=$(c,r);y.set(o,n,a);break}case"RichText":{D({pointer:"",mappings:s,data:c,hiddenStrings:r});break}case"Array":{const a=c.map(f=>typeof f=="string"?$(f,r):f);y.set(o,n,a);break}}}const ie=(e,t)=>{if(!e||!e.extensions||!e.extensions.contentSourceMaps)return console.error("GraphQL response does not contain Content Source Maps information.",e),e;const r=M(e),{spaces:o,environments:n,editorInterfaces:s,fields:i,locales:c,entries:a,assets:f,mappings:m,fieldTypes:g}=r.extensions.contentSourceMaps,p=r;for(const d in m){const{source:l}=m[d],h="entry"in l?a[l.entry]:f[l.asset],L="entry"in l?"Entry":"Asset";if(!h)return r;const v=o[h.space],w=n[h.environment],A=h.id,S=i[l.field],N=c[l.locale],I=s[l.editorInterface],R=g[l.fieldType];if(!(P(I.widgetNamespace)&&!x(I.widgetId)))if(y.has(p,d)){const J=y.get(p,d);if(J!==null){const B=T({entityId:A,entityType:L,space:v,environment:w,field:S,locale:N,editorInterface:I,fieldType:R,targetOrigin:t});O(R,J,B,p,d,m)}}else console.error(`Pointer ${d} not found in GraphQL data or href could not be generated.`)}return r},E=(e,t,r,o)=>{if(!e.fields)return;const{contentSourceMaps:n}=e.sys;if(!n){console.error("Content source maps data is missing");return}const{mappings:s}=n;for(const i in s){const{source:c}=s[i],a=e.sys.space.sys.id,f=e.sys.environment.sys.id,m=e.sys.id,g=e.sys.type,p=t[c.fieldType],d=r[c.editorInterface];if(P(d.widgetNamespace)&&!x(d.widgetId))continue;const l=i.startsWith("/")?i:`/${i}`;if(y.has(e,l)){const h=y.get(e,l);if(h===null)return;const v=l.split("/").pop();if(!v){console.error("Field name could not be extracted from the pointer",l);return}const w=e.sys.locale;if(w){const A=T({entityId:m,entityType:g,space:a,environment:f,field:v,locale:w,editorInterface:d,fieldType:p,targetOrigin:o});O(p,h,A,e,l,s)}else Object.keys(h).forEach(S=>{const N=T({entityId:m,entityType:g,space:a,environment:f,field:v,locale:S,editorInterface:d,fieldType:p,targetOrigin:o});O(p,h,N,e,`${l}/${S}`,s,S)})}else console.error("Pointer not found in the target",i,e)}},ae=(e,t)=>{var o;const r=M(e);if(r.sys&&"items"in r){const n=r;if(!((o=n.sys)!=null&&o.contentSourceMapsLookup))return console.error("Content source maps lookup data is missing"),n;const{contentSourceMapsLookup:{fieldTypes:s,editorInterfaces:i}}=n.sys,{items:c,includes:a}=n;c.forEach(f=>E(f,s,i,t)),a&&a.Entry&&a.Entry.forEach(f=>E(f,s,i,t)),a&&a.Asset&&a.Asset.forEach(f=>E(f,s,i,t))}else{const n=r;if(!n.sys.contentSourceMapsLookup)return console.error("Content source maps lookup data is missing"),n;E(n,n.sys.contentSourceMapsLookup.fieldTypes,n.sys.contentSourceMapsLookup.editorInterfaces,t)}return r};exports.SUPPORTED_WIDGETS=j;exports.clone=M;exports.combine=$;exports.createSourceMapMetadata=T;exports.decode=te;exports.encode=ee;exports.encodeCPAResponse=ae;exports.encodeField=O;exports.encodeGraphQLResponse=ie;exports.encodeRichTextValue=D;exports.isBuiltinNamespace=P;exports.isSupportedWidget=x;exports.splitEncoding=ne;
//# sourceMappingURL=index.cjs.map
